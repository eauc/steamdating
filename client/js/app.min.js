"use strict";angular.module("srApp.services",[]),angular.module("srApp.filters",[]),angular.module("srApp.controllers",[]),angular.module("srApp.directives",[]),angular.module("srApp",["ui.router","srApp.controllers","srApp.filters","srApp.services","srApp.directives"]).config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/players_ranking"),a.state("file",{url:"/file",templateUrl:"partials/file.html",controller:"fileCtrl",data:{}}).state("players_list",{url:"/players_list",templateUrl:"partials/playersList.html",controller:"playersListCtrl",data:{sort:"Name",exports:["fk","sheets"]}}).state("players_ranking",{url:"/players_ranking",templateUrl:"partials/playersRanking.html",controller:"playersListCtrl",data:{sort:"Rank",exports:["csv_rank","bb_rank"]}}).state("groups_edit",{url:"/groups_edit",templateUrl:"partials/groups_edit.html",controller:"groupEditCtrl",data:{}}).state("player_edit",{templateUrl:"partials/player_edit.html",controller:"playerEditCtrl",data:{}}).state("rounds",{url:"/rounds",templateUrl:"partials/rounds.html",controller:"roundsCtrl",data:{}}).state("rounds.sum",{url:"/sum",templateUrl:"partials/rounds_sum.html",controller:"roundsSumCtrl",data:{}}).state("rounds.next",{url:"/next",templateUrl:"partials/rounds_next.html",controller:"roundsNextCtrl",data:{}}).state("rounds.nth",{url:"/:pane",templateUrl:"partials/rounds_nth.html",controller:"roundsNthCtrl",data:{}}).state("game_edit",{templateUrl:"partials/game_edit.html",controller:"gameEditCtrl",data:{}}).state("stats",{url:"/stats",templateUrl:"partials/stats.html",controller:"statsCtrl",data:{}}).state("settings_edit",{url:"/settings_edit",templateUrl:"partials/settings_edit.html",controller:"settingsEditCtrl",data:{}})}]).config(["$compileProvider",function(a){a.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|blob):/)}]),angular.module("srApp.controllers").controller("fileCtrl",["$scope","$q","prompt","state","fileExport","fileImport","factions",function(a,b,c,d,e,f,g){a.$on("$destroy",function(){R.forEach(function(b){e.cleanup(a.exports[b].url)},R.keys(a.exports))}),a.updateExports=function(){var b=(new Date).getTime();a.save={name:"steamdating_"+b+".json",url:e.generate("json",a.state)}},a.updateExports(),a.factions={},b.when(g.baseFactions()).then(function(b){a.factions=b}),a.doReset=function(){return d.isEmpty(a.state)?void a.resetState():void c.prompt("confirm","You sure ?").then(function(){a.resetState(),a.goToState("players_list")})},a.doOpenFile=function(b){f.read("json",b[0],a.factions).then(function(b){var c=b[0],d=b[1];a.resetState(c),a.open_result=d,a.goToState("players_ranking")},function(b){a.open_result=b})},a.doImportFile=function(e,g){f.read(e,g[0],a.factions).then(function(f){var g=f[0],h=f[1];b.when(d.isEmpty(a.state)?!0:c.prompt("confirm","You'll lose current data.")).then(function(){a.resetState({players:[g]}),a["import_"+e+"_result"]=h,R.isEmpty(h)?a.goToState("players_list"):(a["import_"+e+"_result"].push(g.length+" players have been read successfully"),a.updateExports())})},function(b){a["import_"+e+"_result"]=b})}}]),angular.module("srApp.controllers").controller("gameEditCtrl",["$scope","players","lists",function(a,b,c){a.game=R.clone(a.edit.game),a.setWinLoss=function(a,b,c){1===a[b].tournament?(a[b].tournament=0,a[c].tournament=0):(a[b].tournament=1,a[c].tournament=0)},a.close=function(b){b&&(R.deepExtend(a.edit.game,a.game),a.updatePoints(),a.storeState()),a.goToState(a.edit.back,{pane:a.edit.pane})},a.casters={},a.casters[a.game.p1.name]=R.pipe(b.player$(a.game.p1.name),R.defaultTo({lists:[]}),R.prop("lists"),c.casters)(a.state.players),a.casters[a.game.p2.name]=R.pipe(b.player$(a.game.p2.name),R.defaultTo({lists:[]}),R.prop("lists"),c.casters)(a.state.players)}]),angular.module("srApp.controllers").controller("groupEditCtrl",["$scope","prompt","players","state",function(a,b,c,d){a.new_state=R.assoc("players",R.pipe(d.sortPlayersByRank,R.map(function(a){return R.pipe(R.map(R.prop("players")),R.flatten)(a)}))(a.state),a.state),a.selection={},a.isSelectionEmpty=function(){return!R.pipe(R.values,R.any(R.identity))(a.selection)},a.chunkGroups=function(){b.prompt("prompt","Groups size").then(function(b){var e=parseFloat(b);R.eq(0/0,e)||(a.new_state.players=c.chunkGroups(parseFloat(e),a.new_state.players),a.new_state=d.clearBracket(a.new_state))})},a.splitSelection=function(){var b=R.reduce(function(b,c){return a.selection[c]?R.append(c,b):b},[],R.keys(a.selection));a.new_state.players=c.splitNewGroup(b,a.new_state.players),a.new_state=d.clearBracket(a.new_state)},a.moveSelectionFront=function(){var b=R.reduce(function(b,c){return a.selection[c]?R.append(c,b):b},[],R.keys(a.selection));R.forEach(function(b){a.new_state.players=c.movePlayerGroupFront(b,a.new_state.players)},b),a.new_state=d.clearBracket(a.new_state)},a.moveSelectionBack=function(){var b=R.reduce(function(b,c){return a.selection[c]?R.append(c,b):b},[],R.keys(a.selection));R.forEach(function(b){a.new_state.players=c.movePlayerGroupBack(b,a.new_state.players)},b),a.new_state=d.clearBracket(a.new_state)},a.moveGroupFront=function(b){a.new_state.players=c.moveGroupFront(b,a.new_state.players),a.new_state=d.clearBracket(a.new_state)},a.moveGroupBack=function(b){a.new_state.players=c.moveGroupBack(b,a.new_state.players),a.new_state=d.clearBracket(a.new_state)},a.doClose=function(b){b&&(a.state.players=a.new_state.players,a.state.bracket=a.new_state.bracket,a.updatePoints(),a.storeState()),a.goToState(R.defaultTo("players_list",a.edit.back))}}]),angular.module("srApp.controllers").controller("mainCtrl",["$scope","$state","$q","factions","resultSheetsHtml","state","scenario",function(a,b,c,d,e,f,g){d.init(),e.init(),g.init().then(function(b){a.scenarios=b}),a.resetState=function(b){a.state=f.create(b)},a.state=f.init(),a.goToState=R.bind(b.go,b),a.currentState=function(){return b.current.name},a.stateIs=R.bind(b.is,b),a.edit={},a.doEditPlayer=function(c){a.edit.player=c,a.edit.back=b.current.name,a.goToState("player_edit")},a.updatePoints=function(){a.state=f.updatePlayersPoints(a.state),a.state=f.updateBestsPlayers(a.state)},a.storeState=function(){f.store(a.state)}}]),angular.module("srApp.controllers").controller("playersListCtrl",["$scope","$state","$q","prompt","state","stateTables","resultSheetsHtml","players","player","fileExport",function(a,b,c,d,e,f,g,h,i,j){function k(){a.sorted_players=e["sortPlayersBy"+b.current.data.sort](a.state)}a.updatePoints(),k();var l={fk:function(b){b.fk={name:"players_list.txt",url:j.generate("fk",a.state.players),label:"FK players list"}},csv_rank:function(a,b){a.csv_rank={name:"players_ranking.csv",url:j.generate("csv",b),label:"CSV Ranking"}},bb_rank:function(a,b){a.bb_rank={name:"players_ranking.txt",url:j.generate("bb",b),label:"BB Ranking"}},sheets:function(b){b.sheets={name:"players_sheets.html",url:null,label:"Players Result Sheets"},c.when(g.generate(a.sorted_players)).then(function(a){b.sheets.url=j.generate("text",a)})}};a.updateExports=function(){var c=f.rankingTables(a.state);a.exports={},R.forEach(function(b){l[b](a.exports,c)},b.current.data.exports)},a.updateExports(),a.doEditGroups=function(){a.edit.back=b.current.name,a.goToState("groups_edit")},a.doAddPlayer=function(c){a.edit.player=i.create(),a.edit.group=c,a.edit.back=b.current.name,a.goToState("player_edit")},a.doDropPlayer=function(b,c,d){R.deepExtend(c,b?i.drop(a.state.rounds.length,c):i.undrop(c)),e.store(a.state),d.stopPropagation()},a.doDeletePlayer=function(b,c){d.prompt("confirm","You sure ?").then(function(){a.state.players=h.drop(b,a.state.players),e.store(a.state),k()}),c.stopPropagation()}}]).controller("playerEditCtrl",["$scope","$q","prompt","factions","players","list","lists",function(a,b,c,d,e,f,g){a.player=R.clone(a.edit.player),b.when(d.baseFactions()).then(function(b){a.factions=e.factions(b,a.state.players)}),a.origins=e.origins(a.state.players),a.doClose=function(b){if(b){if("String"!==R.type(a.player.name)||s.isBlank(a.player.name))return void c.prompt("alert","invalid player name");var d=e.names(a.state.players);if(R.exists(a.edit.player.name)&&(d=R.reject(R.eq(a.edit.player.name),d)),0<=R.indexOf(a.player.name,d))return void c.prompt("alert","a player with the same name already exists");R.isNil(a.edit.player.name)?a.state.players=e.add(a.edit.group,a.player,a.state.players):R.extend(a.edit.player,a.player),a.storeState()}a.goToState(a.edit.back)},a.list=R.isEmpty(a.player.lists)?-1:0,a.doSwitchToList=function(b){a.list=b},a.doAddList=function(){a.list=a.player.lists.length,a.player.lists=g.add(f.create({faction:a.player.faction}),a.player.lists)},a.doDropList=function(b){a.player.lists=g.drop(b,a.player.lists)}}]),angular.module("srApp.controllers").controller("roundsCtrl",["$scope","$state","round",function(a,b,c){a.round={},a.doGameEdit=function(d,e,f){a.edit.game=c.gameForPlayer(e,d),a.edit.back=b.current.name,a.edit.pane=f,a.goToState("game_edit")}}]).controller("roundsSumCtrl",["$scope","players","round","state","stateTables","fileExport",function(a,b,c,d,e,f){a.state.players=b.updateListsPlayed(a.state.rounds,a.state.players),a.sorted_players=d.sortPlayersByName(a.state),a.games_by_players=b.gamesForRounds(a.state.rounds,a.sorted_players),a.updateExports=function(){var b=e.roundsSummaryTables(a.state);a.exports={csv:{name:"rounds_summary.csv",url:f.generate("csv",b),label:"CSV Rounds Summary"},bb:{name:"rounds_summary.txt",url:f.generate("bb",b),label:"BBCode Rounds Summary"}}},a.updateExports()}]).controller("roundsNextCtrl",["$scope","state","bracket","round","rounds","players","srPairing","bracketPairing","scenario","games",function(a,b,c,d,e,f,g,h,i,j){a.new_state=R.clone(a.state),a.previous_round_complete=e.lastRoundIsComplete(a.new_state.rounds),a.next_round=b.createNextRound(a.state),a.scenario={next:null};var k=b.playerRankPairs(a.new_state);a.updatePlayersOptions=function(){a.players_options=R.pipe(b.playersNotDropedInLastRound,R.mapIndexed(function(b,c){return R.map(function(b){var e=R.pipe(d.gamesForGroup$(c),j.isPlayerPaired$(b))(a.next_round),f=e?b.name:"> "+b.name;return f+=" #"+(k[c][b.name]||"??"),[b.name,f]},b)}))(a.new_state),a.round_fitness=b.evaluateRoundFitness(a.next_round,a.new_state),a.tables_ranges=R.pipe(b.playersNotDropedInLastRound,R.mapIndexed(function(c,d){return R.pipe(b.playersNotDropedInLastRound,f.tableRangeForGroup$(d))(a.new_state)}))(a.new_state)},a.updatePlayersOptions(),a.suggestNextRound=function(b,d){"bracket"===d&&(a.new_state.bracket=c.set(b,a.new_state.rounds.length,a.new_state.bracket),a.next_round.games[b]=h.suggestRound(a.new_state,b)),"sr"===d&&(a.new_state.bracket=c.reset(b,a.new_state.bracket),a.next_round.games[b]=g.suggestNextRound(a.new_state,b)),a.updatePlayersOptions()},a.registerNextRound=function(){a.state.bracket=a.new_state.bracket,a.state.scenario=i.set(a.new_state.rounds.length,a.scenario.next,a.new_state.scenario),a.state.rounds=e.registerNextRound(a.next_round,a.new_state.rounds),a.storeState(),a.goToState("rounds.nth",{pane:a.state.rounds.length-1})},a.updatePlayer=function(b,c,d){a.next_round.games[b]=j.updatePlayer(c,d,a.next_round.games[b]),a.updatePlayersOptions()},a.updateTable=function(b,c){a.next_round.games[b]=j.updateTable(c,R.min(a.tables_ranges[b]),a.next_round.games[b]),a.updatePlayersOptions()}}]).controller("roundsNthCtrl",["$scope","$stateParams","prompt","rounds","fileExport","state","stateTables",function(a,b,c,d,e,f,g){return a.round.current=parseFloat(b.pane),a.r=a.state.rounds[a.round.current],R.isNil(a.r)?void a.goToState("rounds.sum"):(a.updateExports=function(){var b=g.roundTables(a.round.current,a.state);a.exports={csv:{name:"round_"+(a.round.current+1)+".csv",url:e.generate("csv",b),label:"CSV Round"},bb:{name:"round_"+(a.round.current+1)+".txt",url:e.generate("bb",b),label:"BBCode Round"}}},a.updateExports(),void(a.doDeleteRound=function(b){c.prompt("confirm","You sure ?").then(function(){a.state.rounds=d.drop(parseFloat(b),a.state.rounds),a.updatePoints(),a.storeState(),a.goToState("rounds.sum")})}))}]),angular.module("srApp.controllers").controller("settingsEditCtrl",["$scope","prompt","ranking","player",function(a,b,c,d){function e(){a.player_ranking_valid=!0;var b=c.buildPlayerCritFunction(a.player_test.ranking,a.player_test.n_rounds,a.player_test.n_players);return"Function"!==R.type(b)?(a.player_test.player1.rank=b,a.player_test.player2.rank=b,void(a.player_ranking_valid=!1)):(a.player_test.player1.rank=d.rank(b,a.player_test.player1),"Number"!==R.type(a.player_test.player1.rank)&&(a.player_ranking_valid=!1),a.player_test.player2.rank=d.rank(b,a.player_test.player2),void("Number"!==R.type(a.player_test.player2.rank)&&(a.player_ranking_valid=!1)))}a.pane="custom_fields",a.criterions=R.clone(c.criterions),a.player_test={ranking:a.state.ranking.player,n_rounds:5,n_players:32,player1:{name:"p1",custom_field:21,points:{tournament:4,sos:10,control:13,army:38,assassination:3,custom_field:14},rank:0},player2:{name:"p2",custom_field:19,points:{tournament:3,sos:15,control:8,army:45,assassination:5,custom_field:25},rank:0}},a.$watch("player_test",e,!0),a.doClose=function(c){if(c){if(!a.player_ranking_valid)return b.prompt("alert","current player ranking is invalid !"),void(a.pane="player_ranking");a.state.ranking.player=a.player_test.ranking,a.storeState()}a.goToState("players_ranking")}}]),angular.module("srApp.controllers").controller("statsCtrl",["$scope","$q","factions","players","stats",function(a,b,c,d,e){a.factions=d.factions([],a.state.players),a.players=d.names(a.state.players),a.casters=d.casters(a.state.players),a.stats={};a.getStats=function(){var b=a.selection[a.selection.type],c=e.get(a.state,a.selection.type,b,a.selection.group_by,a.stats);return 0>R.indexOf(a.group,R.map(R.head,c))&&(a.group=c[0][0]),c},a.selection={type:"faction",group_by:"total",faction:R.head(a.factions),player:R.head(a.players),caster:R.prop("name",R.defaultTo({},R.head(a.casters)))},a.setGroup=function(b){a.group=b}}]),angular.module("srApp.directives").factory("appCache",["$window","$rootScope",function(a){function b(a){var b="progress"===a.type;c.progress=b?(c.progress+1)%100:0,c.onProgress(b)}var c={progress:0,onProgress:function(){},onUpdateReady:function(){}},d=a.applicationCache;return d.addEventListener("cached",b,!1),d.addEventListener("checking",b,!1),d.addEventListener("downloading",b,!1),d.addEventListener("error",b,!1),d.addEventListener("noupdate",b,!1),d.addEventListener("obsolete",b,!1),d.addEventListener("progress",b,!1),d.addEventListener("updateready",function(a){d.status===d.UPDATEREADY&&c.onUpdateReady(),c.progress=0,c.onProgress(!1)},!1),c}]).directive("appCacheProgressBar",function(){return{restrict:"E",template:'<div class="appcache-progress"     ng-show="appCache.progress != 0">  <div class="appcache-progress-bar"       ng-style="{\'width\': appCache.progress + \'%\' }"></div></div>',controller:["$scope","$window","prompt","appCache",function(a,b,c,d){a.appCache=d,d.onProgress=function(){a.$digest()},d.onUpdateReady=function(){c.prompt("confirm","A new version of this site is available. Load it?").then(function(){b.location.reload()})}}],link:function(){}}}),angular.module("srApp.directives").directive("autofocus",function(){return{restrict:"A",link:function(a,b){b[0].focus()}}}),angular.module("srApp.directives").controller("barsCtrl",["$scope",function(a){a.$watch("values",function(b){if(R.isNil(b))return void(a.bars=[]);var c=R.max(R.values(b)),d=30/Math.max(1,R.keys(b).length-1);a.bars=R.pipe(R.keys,R.map(function(d){return{k:d,name:s.capitalize(d),width:a.width*b[d]/c,value:b[d]}}),function(a){return R.sort(function(a,b){return a.value<b.value?1:b.value<a.value?-1:a.name.localeCompare(b.name)},a)},R.mapIndexed(function(b,c){return b.color=R.exists(R.prop(b.k,R.defaultTo({},a.hues)))?"hsl("+R.prop(b.k,a.hues)[0]+", "+R.prop(b.k,a.hues)[1]+"%, 52%)":"hsl("+a.hue+", "+a.saturation+"%, "+(35+c*d)+"%)",b}))(b)})}]).directive("bars",[function(){return{restrict:"E",templateUrl:"/partials/directives/bars.html",scope:{values:"=barsValues",hues:"=barsHues"},controller:"barsCtrl",link:function(a,b,c){a.width=.7*(b[0].querySelector("table").offsetWidth>>0),a.height=50,a.hue="200",c.$observe("barsHue",function(b){a.hue=R.exists(b)?b:"200"}),a.saturation="75",c.$observe("barsSaturation",function(b){a.saturation=R.exists(b)?b:"75"})}}}]),angular.module("srApp.directives").directive("closeAllDropdown",[function(){return{restrict:"A",link:function(a,b){b.on("click",function(){a.$broadcast("close-dropdown")})}}}]).directive("openDropdown",[function(){return{restrict:"A",link:function(a,b,c){var d=c.openDropdown,e=angular.element(document.getElementById(d));R.isNil(e)||(b.on("click",function(a){e.toggleClass("open"),a.stopPropagation()}),a.$on("close-dropdown",function(){e.removeClass("open")}))}}}]),angular.module("srApp.directives").directive("eaFile",function(){return{restrict:"A",scope:{eaFile:"&"},controller:["$scope",function(){}],link:function(a,b){b[0].onchange=function(){var c=b[0].files;a.eaFile({file:c})}}}}),angular.module("srApp.directives").factory("prompt",["$q",function(a){function b(){if(R.exists(c))return c;var b=a.defer();return e.push(b),b.promise}var c,d,e=[];return{register:function(a){c=a,c.active=!1,c.message=null,c.type="alert",c.input=null,c.doValidate=function(){c.close(),d.resolve(c.input),d=null},c.doCancel=function(){c.close(),d.reject(),d=null},R.forEach(function(a){a.resolve(c)},e),e=[]},prompt:function(c,e){return d=a.defer(),a.when(b()).then(function(a){a.type=c,a.message="String"===R.type(e)?[e]:e,a.input=null,a.open()}),d.promise}}}]).controller("promptCtrl",["$scope","prompt",function(a,b){b.register(a)}]).directive("prompt",["$timeout",function(a){return{restrict:"E",templateUrl:"/partials/directives/prompt.html",scope:!0,controller:"promptCtrl",link:function(b,c){var d=c[0].querySelector("input");b.open=function(){b.active=!0,a(function(){d.focus()},200)},b.close=function(){b.active=!1}}}}]),angular.module("srApp.directives").controller("stacksCtrl",["$scope",function(a){a.$watch("values",function(b){if(R.isNil(b))return void(a.stacks=[]);var c=R.reduce(function(a,c){return a[c]=R.reduce(R.add,0,b.values[c]),a},{},R.keys(b.values));a.stacks=R.map(function(d){var e=0;return{name:d,layers:R.mapIndexed(function(f,g){var h=0<c[d]?a.width*f/c[d]:a.width/b.values[d].length,i={x:e,width:h,color:b.colors[g],value:s.numberFormat(f,2)};return e+=h,i},b.values[d])}},R.keys(b.values))})}]).directive("stacks",[function(){return{restrict:"E",templateUrl:"/partials/directives/stacks.html",scope:{values:"=stacksValues"},controller:"stacksCtrl",link:function(a,b){a.width=.7*(b[0].querySelector("table").offsetWidth>>0),a.height=50}}}]),angular.module("srApp.filters").filter("factions",["factions",function(a){return function(b,c){var d=R.tail(R.tail(arguments));return a[c].apply(null,R.append(b,d))}}]),angular.module("srApp.filters").filter("player",["player",function(a){return function(b,c){var d=R.tail(R.tail(arguments));return a[c].apply(null,R.append(b,d))}}]).filter("players",["players",function(a){return function(b,c){var d=R.tail(R.tail(arguments));return a[c].apply(null,R.append(b,d))}}]),angular.module("srApp.filters").filter("game",["game",function(a){return function(b,c){var d=R.tail(R.tail(arguments));return a[c].apply(null,R.append(b,d))}}]).filter("rounds",["rounds",function(a){return function(b,c){var d=R.tail(R.tail(arguments));return a[c].apply(null,R.append(b,d))}}]).filter("round",["round",function(a){return function(b,c){var d=R.tail(R.tail(arguments));return a[c].apply(null,R.append(b,d))}}]),angular.module("srApp.filters").filter("state",["state",function(a){return function(b,c){var d=R.tail(R.tail(arguments));return a[c].apply(null,R.append(b,d))}}]),R.addHeaderLists=function(){return R.curry(function(a,b,c){return R.reduce(function(b,c){var d=R.find(function(a){return a[0]===c[0]},b);return R.isNil(d)?R.append(R.clone(c),b):(d[1]=a(d[1],c[1]),b)},R.clone(b),c)})}(),R.addObjects=function(){return R.curry(function(a,b,c){return R.reduce(function(b,d){return R.isNil(b[d])?R.assoc(d,c[d],b):R.assoc(d,a(b[d],c[d]),b)},b,R.keys(c))})}(),R.chunkAll=function(){return R.curry(function(a,b,c){b=R.defaultTo(a,b);var d=function(a,b,c){return R.isEmpty(a)?[]:R.prepend(R.take(b,a),d(R.drop(c,a),b,c))};return d(c,a,b)})}(),R.curryService=function(){return function(a){R.pipe(R.functions,R.reject(R.match(/\$$/)),R.forEach(function(b){a[b+"$"]=R.curry(a[b])}))(a)}}(),R.extend=function(){return function(a){var b=Array.prototype.slice;return R.forEach(function(b){for(var c in b)a[c]=b[c]},b.call(arguments,1)),a}}(),R.deepExtend=function(){return function(a){var b=/#{\s*?_\s*?}/,c=Array.prototype.slice;return R.forEach(function(c){for(var d in c)if(R.isNil(a[d])||"Function"===R.type(a[d])||"Date"===R.type(c[d]))a[d]=c[d];else if("String"===R.type(c[d])&&b.test(c[d]))"String"===R.type(a[d])&&(a[d]=c[d].replace(b,a[d]));else if("Array"===R.type(a[d])||"Array"===R.type(c[d])){if("Array"!==R.type(a[d])||"Array"!==R.type(c[d]))throw new Error("Trying to combine an array with a non-array ("+d+")");a[d]=R.deepExtend(a[d],c[d])}else if("Object"===R.type(a[d])||"Object"===R.type(c[d])){if("Object"!==R.type(a[d])||"Object"!==R.type(c[d]))throw new Error("Trying to combine an object with a non-object ("+d+")");a[d]=R.deepExtend(a[d],c[d])}else a[d]=c[d]},c.call(arguments,1)),a}}(),R.exists=R.not(R.isNil),R.shuffle=function(){function a(a,b){return R.isNil(b)&&(b=a,a=0),a+Math.floor(Math.random()*(b-a+1))}return function(b){var c,d=0,e=[];return R.forEach(function(b){c=a(d++),e[d-1]=e[c],e[c]=b},b),e}}(),R.spy=function(){return function(){var a=R.slice(0,arguments.length,arguments);return function(b){return console.log.apply(console,R.append(b,a)),b}}}(),R.toHeaderList=function(){return function(a){return R.map(function(b){return[b,a[b]]},R.keys(a))}}(),angular.module("srApp.services").factory("bbStringifier",[function(){function a(a,b){return"["+a+"]"+b+"[/"+a+"]"}function b(a,b){return"[color="+a+"]"+b+"[/color]"}function c(a){return"Array"===R.type(a)?a.join(g):a}function d(a){if("Object"===R.type(a)){var d=c(a.value);return a.color&&(d=b(a.color,d)),d}return c(a)}function e(b,c){return R.pipe(R.map(R.defaultTo("")),R.map(d),R.map(function(b){return 0===c?a("b",b):b}),R.map(h("center")),R.map(h("td")),R.join(""),h("tr"))(b)}function f(b){var c=R.pipe(R.tail,R.mapIndexed(e),R.join(g),h("table"))(b);return R.join(g,[a("b",R.head(b).join(" ")),c])}var g="\r\n",h=R.curry(a),i={stringify:function(a){return R.pipe(R.mapIndexed(f),R.flatten,R.join(g+g))(a)}};return i}]),angular.module("srApp.services").factory("bracket",[function(){var a={clear:function(a){return R.repeat(void 0,a)},setLength:function(a,b){return b=R.defaultTo([],b),b.length>=a?R.clone(b):R.concat(b,R.repeat(void 0,a-b.length))},set:function(b,c,d){return d=a.setLength(b+1,d),d[b]=R.exists(d[b])?d[b]:c,d},reset:function(b,c){return c=a.setLength(b+1,c),c[b]=void 0,c},isBracketTournament:function(b,c,d){return d=a.setLength(b+1,d),R.exists(d[b])&&c>=d[b]},nbRounds:function(b,c,d){return d=a.setLength(b+1,d),R.exists(d[b])?c-d[b]:0},roundOf:function(a,b,c,d){if(R.isNil(d[a]))return"Not in bracket";var e=b>>c-d[a]+1;switch(e){case 0:return"Ended";case 1:return"Final";case 2:return"Semi-finals";case 4:return"Quarter-finals";default:return"Round of "+e}}};return R.curryService(a),a}]),angular.module("srApp.services").factory("csvStringifier",[function(){function a(a){return R.pipe(function(a){return"Array"===R.type(a)?a.join(" "):a},function(a){return"String"===R.type(a)?a.replace(/\"/g,'""'):a},R.defaultTo(""),function(a){return'"'+a+'"'})(a)}function b(b){return a("Object"===R.type(b)?b.value:b)}function c(a){return R.pipe(R.map(b),R.join(","))(a)}function d(a){return R.pipe(R.mapIndexed(c),R.join(e))(a)}var e="\r\n",f={stringify:function(a){return R.pipe(R.mapIndexed(d),R.join(e+e))(a)}};return f}]),angular.module("srApp.services").factory("factions",["$window","$http","$q",function(a,b,c){function d(){R.forEach(function(a){a.resolve(e)},f),f=[]}var e,f=[],g={init:function(){b.get("/data/factions.json").then(function(a){e=a.data,d()},function(a){})},baseFactions:function(){if(!R.isNil(e))return e;var a=c.defer();return f.push(a),a.promise},iconFor:function(a){return R.pipe(R.defaultTo({}),R.map(R.path([a,"icon"])),R.reject(R.isNil),R.map(function(a){return"data/icons/"+a}),R.head)([e])},hueFor:function(a){return R.path([a,"hue"],R.defaultTo({},e))},castersFor:function(a){return R.path([a,"casters"],R.defaultTo({},e))},casterNameFor:function(a,b){return R.path([a,"casters",b,"name"],R.defaultTo({},e))}};return R.curryService(g),g}]),angular.module("srApp.services").factory("jsonStringifier",[function(){var a={stringify:function(a){return JSON.stringify(a,function(a,b){return s.startsWith(a,"$$")?void 0:b})}};return a}]).factory("fileExport",["$window","fkStringifier","csvStringifier","bbStringifier","jsonStringifier",function(a,b,c,d,e){a.URL=a.URL||a.webkitURL;var f={text:{stringify:function(a){return""+a}},fk:b,csv:c,bb:d,json:e},g={generate:function(b,c){return R.pipe(f[b].stringify,function(b){return new a.Blob([b],{type:"text/plain"})},a.URL.createObjectURL)(c)},cleanup:function(b){R.isNil(b)||a.URL.revokeObjectURL(b)}};return R.curryService(g),g}]),angular.module("srApp.services").factory("fileImport",["$window","$q","t3Parser","fkParser",function(a,b,c,d){var e={t3:c,fk:d,json:{parse:function(a,b){return[JSON.parse(b),[]]}}},f={read:function(c,d,f){var g=new a.FileReader,h=b.defer();return g.onload=function(a){var b;try{b=e[c].parse(f,a.target.result),h.resolve(b)}catch(d){h.reject(["invalid file : "+d.message])}},g.onerror=function(){h.reject(["error reading file"])},g.onabort=function(){h.reject(["abort reading file"])},g.readAsText(d),h.promise}};return R.curryService(f),f}]),angular.module("srApp.services").factory("fkParser",["player","list","lists",function(a,b,c){function d(a,b,c){return a.line_number=c+1,R.cond([e,function(b){return a.state.onParam(a,s(b).strLeft(":").trim().value(),s(b).strRight(":").trim().value(),s.trim(b))}],[s.isBlank,function(){return a.state.onSeparator(a)}],[R.T,function(b){return a.state.onLine(a,s.trim(b))}])(b)}function e(a){return s.include(a,":")}function f(a,b){a.errors.push("line "+a.line_number+" "+b)}function g(a,b){return s.isBlank(b)?(f(a,"empty player name"),a.player=null,void(a.state=v)):(b=s.capitalize(b),0<=R.indexOf(b,a.players)?(f(a,'player name "'+b+'" already exists'),a.player=null,void(a.state=v)):(a.players.push(b),a.player={name:b},void(a.state=r)))}function h(a){return R.isNil(a.player)?(f(a,"unexpected list definition"),void(a.state=v)):(a.list={content:[],faction:a.player.faction},void(a.state=t))}function i(a,b){var c=R.pipe(R.keys,R.filter(function(c){return a.factions[c].name===b}),R.head)(a.factions);return R.isNil(c)?(f(a,'unknown faction "'+b+'"'),void(a.player.faction=b)):void(a.player.faction=c)}function j(a,b){a.player.origin=b}function k(b){b.result.push(a.create({name:b.player.name,faction:b.player.faction,origin:b.player.origin})),b.state=q}function l(a){var d=b.create({faction:a.list.faction,caster:a.list.caster,theme:a.list.theme,fk:a.list.content.join("\n")}),e=R.last(a.result);e.lists=c.add(d,e.lists),a.state=q}function m(a,b){var c,d=R.pipe(R.path([a.list.faction,"casters"]),R.tap(function(a){c=a}),R.keys,R.find(function(a){return s.startsWith(b,c[a].name)}))(a.factions);if(R.isNil(d)){var e=b.match(/([a-zA-Z\s,]+)/);d=R.isNil(e)?"UNKNOWN":e[1],f(a,'unknown caster "'+b+'"')}a.list.caster=d,a.list.content.push(b),a.state=u}var n={parse:function(a,b){var c={factions:a,state:q,result:[],errors:[],players:[]};return R.pipe(s.lines,R.append(""),R.mapIndexed(o(c)))(b),[c.result,c.errors]}},o=R.curry(d),p={onParam:function(a,b,c){f(a,' parameter "'+b+'"="'+s.truncate(c,8)+'" ignored')},onSeparator:function(){},onLine:function(a,b){f(a,"ignored : "+s.truncate(b,15))}},q=R.merge(p,{onParam:function(a,b,c){switch(b){case"Player":return void g(a,c);case"List":return void h(a);default:p.onParam(a,b,c)}}}),r=R.merge(p,{onParam:function(a,b,c){switch(b){case"Faction":return void i(a,c);case"Origin":return void j(a,c);default:p.onParam(a,b,c)}},onSeparator:k}),t=R.merge(p,{onParam:function(a,b,c,d){switch(b){case"Theme":return void(a.list.theme=c);default:s.endsWith(b,"WB")||s.endsWith(b,"WJ")?t.onLine(a,d):p.onParam(a,b,c)}},onSeparator:l,onLine:m}),u=R.merge(p,{onSeparator:t.onSeparator,onParam:function(a,b,c,d){u.onLine(a,d)},onLine:function(a,b){a.list.content.push(b)}},p),v=R.merge(p,{onParam:function(){},onSeparator:function(a){a.state=q},onLine:function(){}});return R.curryService(n),n}]),angular.module("srApp.services").factory("fkStringifier",[function(){function a(a){var d=["Player: "+a.name];return R.isNil(a.origin)||d.push("Origin: "+a.origin),R.isNil(a.faction)||d.push("Faction: "+a.faction),a.lists.length>0&&(d.push(""),d.push(R.pipe(R.map(b),R.join(c))(a.lists))),R.join(c,d)+c}function b(a){var b=["List:"];return R.isNil(a.theme)||b.push("Theme: "+a.theme),b.push(a.fk),b.push(""),R.join(c,b)}var c="\r\n",d={stringify:function(b){return R.pipe(R.flatten,R.map(a),R.join(c))(b)}};return R.curryService(d),d}]),angular.module("srApp.services").factory("game",[function(){var a={create:function(a){return R.deepExtend({table:null,victory:null,p1:{name:null,list:null,tournament:null,control:null,army:null,custom_field:null},p2:{name:null,list:null,tournament:null,control:null,army:null,custom_field:null}},a)},playerNames:function(a){return R.ap([R.path(["p1","name"]),R.path(["p2","name"])])([a])},forPlayer:function(a,b){return a===b.p1.name||a===b.p2.name?b:void 0},player:function(a,b){b=R.defaultTo({},b);var c=R.path(["p1","name"],b);return c===a?R.prop("p1",b):R.prop("p2",b)},opponentForPlayer:function(a,b){var c=R.path(["p1","name"],b);return c===a?R.path(["p2","name"],b):c},hasResult:function(a){return"Number"===R.type(a.p1.tournament)&&"Number"===R.type(a.p2.tournament)},winForPlayer:function(b,c){var d=R.pipe(a.player$(b),R.defaultTo({}),R.prop("tournament"))(c);return 1===d?!0:0===d?!1:void 0},lossForPlayer:function(b,c){var d=R.pipe(a.player$(b),R.defaultTo({}),R.prop("tournament"))(c);return 0===d?!0:1===d?!1:void 0},listForPlayer:function(b,c){return R.prop("list",a.player(b,c))},tableForPlayer:function(a,b){return b=R.defaultTo({},b),R.prop("table",b)},isValid:function(a){return"String"===R.type(R.path(["p1","name"],a))&&"String"===R.type(R.path(["p2","name"],a))},isAssassination$:R.propEq("victory","assassination"),winner:function(a){return R.pathEq(["p1","tournament"],1,a)?a.p1.name:R.pathEq(["p2","tournament"],1,a)?a.p2.name:void 0},loser:function(a){return R.pathEq(["p1","tournament"],0,a)?a.p1.name:R.pathEq(["p2","tournament"],0,a)?a.p2.name:void 0},toArray:function(b,c){var d=[c.table,{value:c.p1.name,color:1===c.p1.tournament?"limegreen":"red"},{value:c.p2.name,color:1===c.p2.tournament?"limegreen":"red"},c.p1.list,c.p2.list,c.p1.tournament,c.p2.tournament,c.p1.control,c.p2.control,c.p1.army,c.p2.army,a.isAssassination$(c)?1:0];return b&&(d=R.concat(d,[c.p1.custom_field,c.p2.custom_field])),d}};return R.curryService(a),a}]).factory("games",["game",function(a){function b(a,b,d,e,f){var g=f>>d-e;return c(d,e)?a+g*b.tournament:a}function c(a,b){return!R.isNil(b)&&a>=b}var d={pointsForPlayer:function(b,c,e,f){var g=R.pipe(R.map(a.player$(b)),d.reducePoints$(c,e))(f);return g.assassination=R.pipe(R.filter(a.winForPlayer$(b)),R.filter(a.isAssassination$),R.length)(f),g},pointsAgainstPlayer:function(b,c,e,f){var g=R.pipe(R.map(function(c){var d=a.opponentForPlayer(b,c);return a.player(d,c)}),d.reducePoints$(c,e))(f);return g.assassination=R.pipe(R.filter(a.lossForPlayer$(b)),R.filter(a.isAssassination$),R.length)(f),g},reducePoints:function(a,c,d){return R.reduceIndexed(function(d,e,f){return{bracket:b(d.bracket,e,f,a,c),tournament:d.tournament+(e.tournament||0),control:d.control+(e.control||0),army:d.army+(e.army||0),custom_field:d.custom_field+(e.custom_field||0),sos:0}
},{bracket:0,tournament:0,control:0,army:0,custom_field:0,sos:0},d)},opponentsForPlayer:function(b,c){return R.pipe(R.map(a.opponentForPlayer$(b)),R.reject(R.isNil))(c)},listsForPlayer:function(b,c){return R.pipe(R.map(a.listForPlayer$(b)),R.uniq,R.reject(R.isNil))(c)},tablesForPlayer:function(b,c){return R.pipe(R.map(a.tableForPlayer$(b)),R.reject(R.isNil))(c)},forCaster:function(b,c,d){return R.filter(R.compose(R.eq(c),a.listForPlayer$(b)),d)},updatePlayer:function(a,b,c){var d=c[a][b].name;return R.pipe(R.mapIndexed(function(c,e){return e===a&&"p1"===b?c:c.p1.name===d?R.assocPath(["p1","name"],null,c):c}),R.mapIndexed(function(c,e){return e===a&&"p2"===b?c:c.p2.name===d?R.assocPath(["p2","name"],null,c):c}))(c)},updateTable:function(a,b,c){var d=c[a].table,e=d-b;return c[e]=R.assoc("table",b+a,c[e]),R.sortBy(R.prop("table"),c)},winners:function(b){return R.pipe(R.map(a.winner))(b)},losers:function(b){return R.pipe(R.map(a.loser))(b)},pairedPlayers:function(a){return R.pipe(R.flatten,R.chain(function(a){return[a.p1.name,a.p2.name]}),R.reject(R.isNil),R.uniq())(a)},isPlayerPaired:function(a,b){return 0<=R.indexOf(a.name,d.pairedPlayers(b))}};return R.curryService(d),d}]),angular.module("srApp.services").factory("list",[function(){var a={create:function(a){return R.merge({faction:null,caster:null,theme:null,fk:null},a)},references:function(a){return R.pipe(R.prop("fk"),s.lines,R.reject(s.isBlank),R.reject(function(a){return a.match(/^\s*Tiers?/)}),R.map(function(a){return a.replace(/\(.*\)/,"")}),R.map(function(a){return a.replace(/\[.*\]/,"")}),R.map(function(a){return a.replace(/- (PC|WJ|WB).*$/,"")}),R.map(function(a){return a.replace(/-[^-]*runt.*$/,"")}),R.map(function(a){return a.replace(/Objective/,"")}),R.map(function(a){return a.replace(/Specialists/,"")}),R.map(function(a){return a.replace(/UA/,"")}),R.map(function(a){return a.replace(/[^a-zA-Z\s&]/g,"")}),R.map(function(a){return s.trim(a)}),R.map(function(a){return s.titleize(a)}),R.filter(R.not(s.isBlank)))(a)}};return R.curryService(a),a}]).factory("lists",["list",function(){var a={add:function(a,b){return R.append(a,b)},drop:function(a,b){return R.remove(a,1,b)},casters:function(a){return R.pluck("caster",a)},listForCaster:function(a,b){return R.pipe(R.filter(R.propEq("caster",a)),R.head)(b)},themeForCaster:function(b,c){return R.pipe(a.listForCaster$(b),R.defaultTo({}),R.prop("theme"))(c)},containsCaster:function(a,b){return R.pipe(R.find(R.propEq("caster",a)),R.not(R.isNil))(b)}};return R.curryService(a),a}]),angular.module("srApp.services").factory("basePairing",["rounds","players",function(a){var b={suggestTableFor:function(b,c,d,e,f){c=R.shuffle(c),f=R.defaultTo(R.max(c)+1,f);var g=a.tablesGroups(f,c),h=R.groupBy(a.tableGroup$(f),c),i=a.tablesForPlayer(d,b),j=a.tablesGroups(f,i),k=a.tablesForPlayer(e,b),l=a.tablesGroups(f,k),m=R.difference(c,R.concat(i,k)),n=R.difference(g,R.concat(j,l));return R.isEmpty(n)?R.isEmpty(m)?c[0]:m[0]:h[n[0]][0]}};return R.curryService(b),b}]).factory("bracketPairing",["basePairing","players","game","games","round","state",function(a,b,c,d,e,f){var g={indices:function(a){return 2===a?[[1,2]]:R.pipe(R.map(function(b){return[[b[0],a+1-b[0]],[a+1-b[1],b[1]]]}),R.reduce(function(a,b){return R.concat(a,b)},[]))(g.indices(a/2))},suggestFirstSingleRound:function(d,e){var h=f.playersNotDropedInLastRound(d),i=b.tableRangeForGroup(e,h),j=R.pipe(R.nth(e),b.sortGroup$(d,!1),R.chain(R.prop("players")))(h);return R.pipe(R.length,g.indices,R.map(function(b){var e=j[b[0]-1].name,f=j[b[1]-1].name,g=a.suggestTableFor(d.rounds,i,e,f,R.prop("tables_groups_size",d));return i=R.reject(R.eq(g),i),c.create({table:g,p1:{name:e},p2:{name:f}})}))(j)},suggestNextSingleRound:function(g,h){var i=f.playersNotDropedInLastRound(g),j=b.tableRangeForGroup(h,i),k=f.bracketNbRounds(h,g),l=i[h].length/(1<<k);return R.pipe(R.prop("rounds"),R.last,e.gamesForGroup$(h),R.chunkAll(l,null),R.reduce(function(b,e){var f=d.winners(e),h=d.losers(e),i=R.chunkAll(2,null,R.concat(f,h)),k=R.map(function(b){var d=a.suggestTableFor(g.rounds,j,b[0],b[1],R.prop("tables_groups_size",g));return j=R.reject(R.eq(d),j),c.create({table:d,p1:{name:b[0]},p2:{name:b[1]}})},i);return R.concat(b,k)},[]))(g)},suggestFirstRound:function(a,b){return g.suggestFirstSingleRound(a,b)},suggestNextRound:function(a,b){return g.suggestNextSingleRound(a,b)},suggestRound:function(a,b){return 0===f.bracketNbRounds(b,a)?g.suggestFirstRound(a,b):g.suggestNextRound(a,b)}};return R.curryService(g),g}]).factory("srPairing",["basePairing","players","rounds","game","state",function(a,b,c,d,e){var f={sortPlayers:function(a){var b;return R.pipe(R.groupBy(R.path(["points","tournament"])),R.tap(function(a){b=a}),R.keys,R.sortBy(function(a){return parseFloat(a)}),R.chain(function(a){return R.shuffle(b[a])}),R.reverse)(a)},sortAvailablePlayersFor:function(a,b){var c;return R.pipe(R.groupBy(R.path(["points","tournament"])),R.tap(function(a){c=a}),R.keys,R.sortBy(function(a){return"undefined"===a?-1:parseFloat(a)}),R.map(function(a){return R.prop(a,c)}),R.chain(R.partition(R.eqProps("origin",b))),R.flatten,R.reverse,R.pluck("name"))(a)},suggestOpponentFor:function(a,b){var c=R.difference(b,a);return 0===c.length?b[0]:c[0]},findNextPairing:function(e,g,h,i){var j=R.head(g);g=R.tail(g);var k=c.opponentsForPlayer(j.name,e),l=f.sortAvailablePlayersFor(g,j),m=f.suggestOpponentFor(k,l),n=b.player(m,g);g=R.reject(R.eq(n),g);var o=a.suggestTableFor(e,h,j.name,n.name,i);return h=R.reject(R.eq(o),h),[d.create({table:o,p1:{name:j.name},p2:{name:n.name}}),g,h]},suggestNextSingleRound:function(a,c){var d=e.playersNotDropedInLastRound(a),g=b.tableRangeForGroup(c,d),h=f.sortPlayers(d[c]);return 1===(1&h.length)&&h.push({name:"_phantom_"}),R.pipe(R.nth(c),R.length,R.flip(R.divide)(2),R.range(0),R.map(function(){var b=f.findNextPairing(a.rounds,h,g,R.prop("tables_groups_size",a));return h=b[1],g=b[2],b[0]}),R.sortBy(R.prop("table")))(d)},suggestNextRound:function(a,b){return f.suggestNextSingleRound(a,b)}};return R.curryService(f),f}]).factory("pairing",["bracketPairing","srPairing",function(a,b){var c={suggestRound:function(c,d,e){return R.isNil(e)?b.suggestRound(c,d):a.suggestRound(c,d,e)}};return c}]),angular.module("srApp.services").factory("player",["rounds","list","lists",function(a,b,c){var d={create:function(a){var c=R.merge({name:null,droped:null,faction:null,origin:null,team:null,custom_field:0,notes:null,lists:[],lists_played:[],points:{tournament:0,sos:0,control:0,army:0,custom_field:0}},a);return c.lists=R.map(b.create,c.lists),c},is:function(a,b){return R.propEq("name",a,b)},rank:function(a,b){var c;try{c=a(b.custom_field,b.points.tournament,b.points.sos,b.points.control,b.points.army,b.points.assassination,b.points.custom_field)}catch(d){return"Error : "+d.message}return c},updateListsPlayed:function(b,c){return R.assoc("lists_played",a.listsForPlayer(c.name,b),c)},allListsHaveBeenPlayed:function(a){return R.pipe(R.prop("lists"),c.casters,R.flip(R.difference)(a.lists_played),R.isEmpty)(a)},updatePoints:function(b,c,d,e){return R.assoc("points",a.pointsForPlayer(e.name,b,c,d),e)},drop:function(a,b){return R.assoc("droped",a,b)},undrop:function(a){return R.assoc("droped",null,a)},hasDropedInRound:function(a,b){return"Number"===R.type(b.droped)&&("Number"!==R.type(a)||b.droped<=a)},isDroped:function(a){return d.hasDropedInRound(null,a)}};return R.curryService(d),d}]).factory("players",["player","factions","game","round","rounds","ranking","lists",function(a,b,c,d,e,f,g){function h(b,c,d){if(c)return function(a){return a.points.bracket};var e=f.buildPlayerCritFunction(b.ranking.player,b.rounds.length,d.length);return"Function"!==R.type(e)?null:a.rank$(e)}var i={add:function(a,b,c){var d=R.append(b,c[a]),e=R.remove(a,1,c);return R.insert(a,d,e)},drop:function(b,c){return R.pipe(R.map(R.reject(a.is$(b.name))),R.reject(R.isEmpty),function(a){return R.isEmpty(a)?[[]]:a})(c)},player:function(b,c){return R.pipe(R.flatten,R.find(a.is$(b)))(c)},dropedInRound:function(b,c){return R.map(R.filter(a.hasDropedInRound$(b)))(c)},notDropedInRound:function(b,c){return R.map(R.reject(a.hasDropedInRound$(b)))(c)},names:function(a){return R.pipe(R.flatten,R.pluck("name"),R.sortBy(R.identity))(a)},factions:function(a,b){return R.pipe(R.flatten,R.pluck("faction"),R.union(R.keys(R.defaultTo({},a))),R.reject(R.isNil),R.sortBy(R.identity))(b)},forFaction:function(a,b){return R.pipe(R.flatten,R.filter(R.propEq("faction",a)))(b)},factionFor:function(a,b){return R.pipe(i.player$(a),R.defaultTo({faction:null}),R.prop("faction"))(b)},casters:function(a){return R.pipe(R.flatten,R.chain(R.prop("lists")),R.reject(R.isNil),R.map(function(a){return R.isNil(a.caster)?void 0:{faction:a.faction||"",name:a.caster}}),R.reject(R.isNil),R.uniqWith(R.eqProps("name")),R.sort(function(a,b){var c=a.faction.localeCompare(b.faction);return 0!==c?c:a.name.localeCompare(b.name)}))(a)},forCaster:function(a,b){return R.pipe(R.flatten,R.filter(R.compose(g.containsCaster$(a),R.defaultTo([]),R.prop("lists"))))(b)},origins:function(a){return R.pipe(R.flatten,R.pluck("origin"),R.uniq,R.reject(R.isNil),R.sortBy(R.identity))(a)},originFor:function(a,b){return R.pipe(i.player$(a),R.defaultTo({origin:null}),R.prop("origin"))(b)},withPoints:function(a,b,c){var d=R.split(".",a);return R.pipe(R.flatten,R.filter(function(a){return 0!==R.path(d,a)&&R.path(d,a)===b}),R.pluck("name"))(c)},maxPoints:function(a,b){var c=R.split(".",a);return R.pipe(R.flatten,R.map(R.path(c)),R.max)(b)},bests:function(a,b){var c={custom_field:i.maxPoints("custom_field",b),points:{sos:i.maxPoints("points.sos",b),control:i.maxPoints("points.control",b),army:i.maxPoints("points.army",b),assassination:i.maxPoints("points.assassination",b),custom_field:i.maxPoints("points.custom_field",b)}};return{undefeated:i.withPoints("points.tournament",a,b),custom_field:i.withPoints("custom_field",c.custom_field,b),points:{sos:i.withPoints("points.sos",c.points.sos,b),control:i.withPoints("points.control",c.points.control,b),army:i.withPoints("points.army",c.points.army,b),assassination:i.withPoints("points.assassination",c.points.assassination,b),custom_field:i.withPoints("points.custom_field",c.points.custom_field,b)}}},gamesForRounds:function(a,b){return R.map(function(b){return R.map(function(b){return R.map(d.gameForPlayer$(b.name),a)},b)},b)},updateListsPlayed:function(b,c){return R.map(R.map(a.updateListsPlayed$(b)))(c)},updatePoints:function(b,c,d,f){return R.pipe(R.mapIndexed(function(e,f){return R.map(a.updatePoints$(b[f],c[f],d),e)}),R.mapIndexed(function(a,b,c){return R.map(function(a){var b=e.opponentsForPlayer(a.name,d);return a.points.sos=i.sosFromPlayers(b,c),a},a)}))(f)},sortGroup:function(a,b,c){var d=h(a,b,c);if(R.isNil(d))return c;var e=0;return R.pipe(R.groupBy(d),function(a){return R.pipe(R.keys,R.sortBy(function(a){return-parseFloat(a)}),R.reduce(function(b,c){return b.push({rank:e+1,players:a[c]}),e+=a[c].length,b},[]))(a)})(c)},sort:function(a,b,c){return R.mapIndexed(function(c,d){return i.sortGroup(a,b[d],c)},c)},sosFromPlayers:function(a,b){return R.pipe(R.map(R.flip(i.player$)(b)),R.reject(R.isNil),R.reduce(function(a,b){return a+R.path(["points","tournament"],b)},0))(a)},areAllPaired:function(a,b){return R.pipe(i.names,R.flip(R.difference)(d.pairedPlayers(a)),R.isEmpty)(b)},indexRangeForGroup:function(a,b){var c=R.pipe(R.slice(0,a),R.flatten,R.length)(b),d=c+b[a].length;return[c,d]},chunkGroups:function(a,b){return R.pipe(R.flatten,R.chunkAll(a,null))(b)},splitNewGroup:function(a,b){var c=R.map(R.flip(i.player$)(b))(a);return R.pipe(R.map(R.flip(R.difference)(c)),R.append(c),R.reject(R.isEmpty))(b)},groupForPlayer:function(a,b){return R.pipe(R.map(R.find(R.propEq("name",a))),R.findIndex(R.not(R.isNil)))(b)},movePlayerGroupFront:function(a,b){var c=i.groupForPlayer(a,b);if(0>=c)return b;var d=i.player(a,b),e=R.difference(b[c],[d]),f=R.append(d,b[c-1]);return R.pipe(R.remove(c-1,2),R.insertAll(c-1,[f,e]),R.reject(R.isEmpty))(b)},movePlayerGroupBack:function(a,b){var c=i.groupForPlayer(a,b);if(0>c||c>=b.length-1)return b;var d=i.player(a,b),e=R.difference(b[c],[d]),f=R.append(d,b[c+1]);return R.pipe(R.remove(c,2),R.insertAll(c,[e,f]),R.reject(R.isEmpty))(b)},moveGroupFront:function(a,b){if(0>=a)return b;var c=b[a];return R.pipe(R.remove(a,1),R.insert(a-1,c))(b)},moveGroupBack:function(a,b){if(0>a||a>=b.length-1)return b;var c=b[a];return R.pipe(R.remove(a,1),R.insert(a+1,c))(b)},size:function(a){return R.flatten(a).length},nbGroups:function(a){return a.length},groupSizeIsEven:function(b,c){return 0===(1&R.pipe(R.reject(a.hasDropedInRound$(b)),R.length)(c))},tableRangeForGroup:function(a,b){var c=i.indexRangeForGroup(a,b);return R.range(Math.round(c[0]/2+1),Math.round(c[1]/2+1))},gameSameFactions:function(a,b){return R.pipe(c.playerNames,R.map(function(a){return R.isNil(a)?null:i.factionFor(a,b)}),function(a){var b=R.isSet(a),c=R.isEmpty(R.reject(R.isNil,a));return!c&&!b})(a)},gameSameOrigins:function(a,b){return R.pipe(c.playerNames,R.map(function(a){return R.isNil(a)?null:i.originFor(a,b)}),function(a){var b=R.isSet(a),c=R.isEmpty(R.reject(R.isNil,a));return!c&&!b})(a)}};return R.curryService(i),i}]),angular.module("srApp.services").factory("ranking",[function(){var a={criterions:{SR:{Baseline:{player:"((tp*n_players*n_players+sos)*5*n_rounds+cp)*100*n_rounds+ap",team:"(((ttp*team_size*n_rounds+tp)*n_teams*n_teams+sos)*5*n_rounds+cp)*100*n_rounds+ap"},"Assassin Scoring":{player:"(tp*n_rounds+ck)*5*n_rounds+cp"},"Control Points Scoring":{player:"((tp*5*n_rounds+cp)*100*n_rounds+ap)*n_players*n_players+sos"},"Destruction Scoring":{player:"((tp*100*n_rounds+ap)*5*n_rounds+cp)*n_players*n_players+sos"}}},buildPlayerCritFunction:function(a,b,c){var d,e;try{d=new Function("n_rounds","n_players","player_custom","tp","sos","cp","ap","ck","game_custom","return "+a+";"),e=R.partial(d,b,c)}catch(f){return"Error : "+f.message}return e}};return R.curryService(a),a}]),angular.module("srApp.services").factory("resultSheetsHtml",["$q","$http","$interpolate","players","rounds","list",function(a,b,c,d,e,f){function g(a){var b=h(a);return p.page({sheets:b})}function h(a){var b=d.size(a),c=e.nbRoundsNeededForNPlayers(b);return R.join("",R.map(function(a){return R.join("",R.map(function(a){return p.sheet({players:p.player(a),rounds:i(c,a),lists:k(a)})},a))},a))}function i(a,b){return p.rounds({rounds:R.pipe(R.max,R.inc,R.range(1),R.map(u(b)),R.join("\r\n"))([5,a])})}function j(a,b){var c=R.max([2,a.lists.length]),d=R.range(1,c+1).join(" / ");return p.round_row({index:b,lists:d})}function k(a){for(var b=a.lists;b.length<2;)b=R.append(f.create(),b);return p.lists({headers:l(b),casters:m(b),themes:n(b),lists:o(b)})}function l(a){return R.join("",R.mapIndexed(function(a,b){return p.list_header({index:b+1})},a))}function m(a){return R.join("",R.mapIndexed(function(a){return p.list_caster({caster:a.caster})},a))}function n(a){return R.join("",R.mapIndexed(function(a){return p.list_theme({theme:a.theme})},a))}function o(a){return R.join("",R.mapIndexed(function(a){var b=R.join("<br />\r\n",s.lines(a.fk));return p.list_content({lines:b})},a))}var p={page:null,sheet:null,player:null,rounds:null,round_row:null,lists:null,list_header:null,list_caster:null,list_theme:null,list_content:null},q=!1,r=[],t={init:function(){R.pipe(R.keys,R.map(function(d){return b.get("data/result_sheets/"+d+".html").then(function(a){p[d]=c(a.data)},function(b){return a.reject()})}),a.all)(p).then(function(){q=!0,R.map(function(a){a.resolve()},r)})},generate:function(b){if(q)return g(b);var c=a.defer();return r.push(c),c.promise.then(function(){return g(b)})}},u=R.curry(j);return R.curryService(t),t}]),angular.module("srApp.services").factory("round",["game","games",function(a,b){var c={create:function(b){var c=1;return{games:R.map(function(b){return R.pipe(R.range(0),R.map(function(){return a.create({table:c++})}))(b.length/2)},b)}},gameForPlayer:function(b,c){return R.pipe(R.prop("games"),R.defaultTo([]),R.flatten,R.map(a.forPlayer$(b)),R.reject(R.isNil),R.head)(c)},hasGamesGroups:function(a){return a.games.length>1},gamesForGroup:function(a,b){return R.nth(a,b.games)},pairedPlayers:function(a){return b.pairedPlayers(a.games)},isPlayerPaired:function(a,c){return b.isPlayerPaired(a,c.games)},allGamesHaveResult:function(b){return R.pipe(R.prop("games"),R.flatten,R.all(a.hasResult))(b)}};return R.curryService(c),c}]).factory("rounds",["round","game","games",function(a,b,c){var d={lastRoundIsComplete:function(b){return R.isEmpty(b)||a.allGamesHaveResult(R.last(b))},registerNextRound:function(a,b){return R.append(a,b)},drop:function(a,b){return R.remove(a,1,b)},pointsForPlayer:function(b,d,e,f){return R.pipe(R.map(a.gameForPlayer$(b)),R.map(function(a){return R.isNil(a)?{p1:{name:b,tournament:0,control:0,army:0,custom_field:0}}:a}),c.pointsForPlayer$(b,d,e))(f)},gamesForPlayer:function(b,c){return R.pipe(R.map(a.gameForPlayer$(b)),R.reject(R.isNil))(c)},opponentsForPlayer:function(b,d){return R.pipe(R.map(a.gameForPlayer$(b)),R.reject(R.isNil),c.opponentsForPlayer$(b))(d)},pairAlreadyExists:function(a,b){return R.isNil(R.path(["p1","name"],a))||R.isNil(R.path(["p2","name"],a))?!1:0<=R.pipe(d.opponentsForPlayer$(a.p1.name),R.indexOf(a.p2.name))(b)},listsForPlayer:function(b,d){return R.pipe(R.map(a.gameForPlayer$(b)),R.reject(R.isNil),c.listsForPlayer$(b))(d)},tablesForPlayer:function(b,d){return R.pipe(R.map(a.gameForPlayer$(b)),R.reject(R.isNil),c.tablesForPlayer$(b))(d)},tableAlreadyPlayed:function(a,c,e){return R.pipe(b.playerNames,R.chain(function(a){return R.isNil(a)?[]:d.tablesForPlayer(a,e)}),R.map(d.tableGroup$(c)),R.indexOf(d.tableGroup(c,a.table)),R.lte(0))(a)},tablesGroups:function(a,b){return R.pipe(R.map(d.tableGroup$(a)),R.uniq)(b)},tableGroup:function(a,b){return Math.floor((b-1)/a)+1},nbRoundsNeededForNPlayers:function(a){for(var b=1,c=2;10>b&&a>c;)b++,c*=2;return b}};return R.curryService(d),d}]),angular.module("srApp.services").factory("scenario",["$http",function(a){var b={init:function(){return a.get("/data/scenarios.json").then(function(a){return a.data},function(a){})},clear:function(a){return R.repeat(null,a)},setLength:function(a,b){return b=R.defaultTo([],b),b.length>=a?R.clone(b):R.concat(b,R.repeat(null,a-b.length))},set:function(a,c,d){return d=b.setLength(a+1,d),d[a]=c,d},reset:function(a,c){return c=b.setLength(a+1,c),c[a]=null,c},hasScenario:function(a,c){return c=b.setLength(a+1,c),R.exists(c[a])&&!R.isNil(c[a])&&0!==R.length(c[a])}};return R.curryService(b),b}]),angular.module("srApp.services").factory("state",["$window","jsonStringifier","player","players","game","list","lists","ranking","round","rounds","bracket",function(a,b,c,d,e,f,g,h,i,j,k){function l(a){return R.pipe(r.sortPlayersByRank,R.head,R.chain(function(a){return R.map(function(b){return[b.faction,b.name,a.rank]},a.players)}),R.uniqWith(R.useWith(R.eq,R.head,R.head)),R.reduce(function(a,b){return a[R.head(b)]=R.tail(b),a},{}))(a)}function m(a){a=R.deepExtend({bracket:[],scenario:[],players:[[]],rounds:[],ranking:{player:h.criterions.SR.Baseline.player,team:h.criterions.SR.Baseline.team},custom_fields:{player:null,game:null},tables_groups_size:null},a);var b=r.version(a);if(b>=u)return a;var c=R.range(b+1,u+1);return R.reduce(function(a,b){return t[b](a)},a,c)}function n(a,b){var c=R.defaultTo(1,R.prop("tables_groups_size",b));return R.map(function(a){return R.map(function(a){return{pair:j.pairAlreadyExists(a,b.rounds),table:j.tableAlreadyPlayed(a,c,b.rounds),faction:d.gameSameFactions(a,b.players),origin:d.gameSameOrigins(a,b.players)}},a)},a)}function o(a){var b=[],c=p("pair")(a);c>0&&b.push(c+" players pair(s) have already been played");var d=p("table")(a);d>0&&b.push(d+" players pair(s) have already played on their table (group)");var e=p("faction")(a);e>0&&b.push(e+" factions mirror match(s)");var f=p("origin")(a);return f>0&&b.push(f+" players pair(s) have the same origin"),b}function p(a){return R.pipe(R.flatten,R.filter(R.propEq(a,!0)),R.length)}var q="sdApp.state",r={isEmpty:function(a){return R.isEmpty(R.flatten(a.players))&&R.isEmpty(R.flatten(a.rounds))},init:function(){var b=a.localStorage.getItem(q);if(R.exists(b))try{return b=JSON.parse(b),r.create(b)}catch(c){}return r.create()},test:function(a){var b=R.clone(a),h=["Faction1","Faction2","Faction3","Faction4"],i=["City1","City2","City3","City4"],j=["Team1","Team2","Team3","Team4"];return b.players=[[],[]],R.range(0,8).map(function(a){var d=R.head(R.shuffle(h));b.players[a>>2].push(c.create({name:"Player"+(a+1),faction:d,origin:R.head(R.shuffle(i)),team:R.head(R.shuffle(j))})),b.players[a>>2][a%4].lists.push(f.create({faction:d,caster:"Caster1"}),f.create({faction:d,caster:"Caster2"})),b.players[a>>2][a%4].custom_field=50*Math.random()>>0}),R.range(0,2).map(function(a){b.rounds.push([]);var c=1;R.forEach(function(f){var h=R.shuffle(d.names(f));R.range(0,h.length/2).map(function(){var f=R.head(h);h=R.tail(h);var i=R.head(h);h=R.tail(h);var j=e.create({table:c++,victory:R.head(R.shuffle(["assassination",null,null])),p1:{name:f},p2:{name:i}});j.p1.list=R.pipe(d.player$(f),R.prop("lists"),g.casters,R.shuffle,R.head)(b.players),j.p2.list=R.pipe(d.player$(i),R.prop("lists"),g.casters,R.shuffle,R.head)(b.players);var k=R.shuffle(["p1","p2"]);j[k[0]].tournament=1,j[k[1]].tournament=0,j.p1.control=5*Math.random()>>0,j.p2.control=5*Math.random()>>0,j.p1.army=50*Math.random()>>0,j.p2.army=50*Math.random()>>0,j.p1.custom_field=50*Math.random()>>0,j.p2.custom_field=50*Math.random()>>0,b.rounds[a].push(j)})},b.players)}),b.bracket=[void 0,1],b.custom_fields.player="PCustom",b.custom_fields.game="GCustom",b=r.updatePlayersPoints(b)},version:function(a){return R.defaultTo(0,R.prop("version",R.defaultTo({},a)))},create:function(a){var b=m(a);return b.players=R.map(function(a){return R.map(c.create,a)},b.players),b.rounds=R.map(function(a){return R.assoc("games",R.map(function(a){return R.map(e.create,a)},a.games),a)},b.rounds),b=r.updatePlayersPoints(b),b.version=u,r.store(b),b},store:function(c){a.localStorage.setItem(q,b.stringify(c))},hasPlayers:function(a){return!R.isEmpty(R.flatten(a.players))},hasPlayerGroups:function(a){return a.players.length>1},isTeamTournament:function(a){return!R.isEmpty(R.flatten(a.teams))},hasPlayerCustomField:function(a){return!s.isBlank(a.custom_fields.player)},hasGameCustomField:function(a){return!s.isBlank(a.custom_fields.game)},hasDropedPlayers:function(a){return R.pipe(r.playersDroped,d.size)(a)>0},playersDroped:function(a){return d.dropedInRound(null,a.players)},playersNotDroped:function(a){return d.notDropedInRound(null,a.players)},playersNotDropedInLastRound:function(a){return d.notDropedInRound(a.rounds.length,a.players)},createNextRound:function(a){return R.pipe(r.playersNotDropedInLastRound,i.create)(a)},clearBracket:function(a){return R.assoc("bracket",k.clear(a.players.length,a.bracket),a)},canBeBracketTournament:function(a,b){var c=R.pipe(r.playersNotDropedInLastRound,R.nth(a),R.length)(b);if(0===c)return!1;for(;0===(1&c);)c>>=1;return 1===c},isBracketTournament:function(a,b,c){return b=R.defaultTo(c.rounds.length,b),k.isBracketTournament(a,b,c.bracket)},bracketNbRounds:function(a,b){return k.nbRounds(a,b.rounds.length,b.bracket)},bracketRoundOf:function(a,b,c){b=R.defaultTo(c.rounds.length,b);var d=r.playersNotDroped(c),e=d[a].length;return k.roundOf(a,e,b,c.bracket)},updatePlayersPoints:function(a){var b=R.assoc("bracket",k.setLength(a.players.length,a.bracket),a),c=R.map(function(a){return a.length/2},b.players);return b=R.assoc("players",d.updatePoints(b.bracket,c,b.rounds,b.players),b)},updateBestsPlayers:function(a){var b=R.assoc("bests",d.bests(R.length(a.rounds),a.players),a);return b=R.assoc("bests_in_faction",l(b),b)},isPlayerBest:function(a,b,c){var d=R.prepend("bests",R.split(".",a));return 0<=R.indexOf(R.prop("name",b),R.path(d,c))},isPlayerBestInFaction:function(a,b){var c=R.defaultTo([],R.path(["bests_in_faction",a.faction],b));return a.name===R.head(c)},sortPlayersByName:function(a){return R.map(function(a){return R.sortBy(R.prop("name"),a)},a.players)},sortPlayersByRank:function(a){var b=R.mapIndexed(function(b,c){return r.isBracketTournament(c,null,a)},a.players);return d.sort(a,b,a.players)},playerRankPairs:function(a){return R.pipe(r.sortPlayersByRank,R.map(function(a){return R.reduce(function(a,b){return R.reduce(function(a,c){return R.assoc(c.name,b.rank,a)},a,b.players)},{},a)}))(a)},evaluateRoundFitness:function(a,b){var c=n(a,b),d=o(c);return{games:c,summary:d}}},t=[function(){},function(a){return R.assoc("rounds",R.map(function(a){return[a]},a.rounds),a)},function(a){return R.assoc("rounds",R.map(function(a){return{games:a}},a.rounds),a)}],u=t.length-1;return R.curryService(r),r}]),angular.module("srApp.services").factory("stateTables",["player","game","round","state",function(a,b,c,d){function e(a){var b=f(a),c=g(a);return[["Bests"],b,c]}function f(a){var b=d.hasPlayerCustomField(a),c=d.hasGameCustomField(a),e=["Undefeated"];return b&&e.push(a.custom_fields.player),e=R.concat(e,["SoS","Scenario","Destruction","Assassin"]),c&&e.push(a.custom_fields.game),e}function g(a){var b=d.hasPlayerCustomField(a),c=d.hasGameCustomField(a),e=[R.path(["bests","undefeated"],a)];return b&&e.push(R.path(["bests","custom_field"],a)),e=R.concat(e,[R.path(["bests","points","sos"],a),R.path(["bests","points","control"],a),R.path(["bests","points","army"],a),R.path(["bests","points","assassination"],a)]),c&&e.push(R.path(["bests","points","custom_field"],a)),e}function h(a){var b=R.pipe(R.prop("bests_in_faction"),R.toPairs,R.map(function(a){return R.concat([a[0]],a[1])}),R.sortBy(R.nth(2)))(a);return[R.concat([["Bests In Faction"],["Faction","Player","Rank"]],b)]}function i(a){d.hasPlayerCustomField(a),d.hasGameCustomField(a);return R.pipe(d.sortPlayersByRank,R.mapIndexed(s(a)),R.mapIndexed(r(a)))(a)}function j(a,b,c){var d=k(a);return R.concat([["Group"+(c+1)],d],b)}function k(a){var b=d.hasPlayerCustomField(a),c=d.hasGameCustomField(a),e=["Rank","Name","Origin","Faction"];return b&&(e=R.concat(e,[a.custom_fields.player])),e=R.concat(e,["TP","SoS","CP","AP","CK"]),c&&(e=R.concat(e,[a.custom_fields.game])),e=R.concat(e,["Drop"])}function l(a,b){var c=d.hasPlayerCustomField(a),e=d.hasGameCustomField(a);return R.pipe(R.map(function(b){return R.map(t(a,b.rank),b.players)}),R.flatten,R.chunkAll(10+(c?1:0)+(e?1:0),null))(b)}function m(b,c,e){var f=d.hasPlayerCustomField(b),g=d.hasGameCustomField(b),h=[c,e.name,e.origin,e.faction];return f&&(h=R.concat(h,[e.custom_field])),h=R.concat(h,[e.points.tournament,e.points.sos,e.points.control,e.points.army,e.points.assassination]),g&&(h=R.concat(h,[e.points.custom_field])),h=R.concat(h,[a.hasDropedInRound(null,e)?"After Round "+e.droped:""])}function n(a,b){var c=R.mapIndexed(function(c,e){return d.isBracketTournament(b,e,a)?d.bracketRoundOf(b,e,a):"Round"+(e+1)},a.rounds);return R.concat(["Player","Lists Played"],c)}function o(a,b){return R.map(u(a),b)}function p(d,e){var f=[e.name,R.length(e.lists_played)+"/"+R.length(e.lists)];return R.forEachIndexed(function(d,g){if(a.hasDropedInRound(g,e))return void f.push("DROPPED");var h=c.gameForPlayer(e.name,d);if(R.isNil(h))return void f.push("-");var i=b.winForPlayer(e.name,h);f.push({value:(i?"W":"L")+" - "+b.opponentForPlayer(e.name,h),color:i?"limegreen":"red"})},d.rounds),f}var q={rankingTables:function(a){var b=e(a),c=h(a),d=i(a),f=R.concat([b],c);return f=R.concat(f,d)},roundsSummaryTables:function(a){return R.pipe(d.sortPlayersByName,R.mapIndexed(function(b,c){var d=n(a,c),e=o(a,b);return R.concat([["Group"+(c+1)],d],e)}))(a)},roundTables:function(a,c){var e=d.hasGameCustomField(c);return R.pipe(R.nth(a),R.prop("games"),R.map(R.map(b.toArray$(e))),R.mapIndexed(function(a,b){var d=["Table","Player1","Player2","Player1.list","Player2.list","Player1.tp","Player2.tp","Player1.cp","Player2.cp","Player1.ap","Player2.ap","CasterKill"];return e&&(d=R.concat(d,["Player1."+c.custom_fields.game,"Player2."+c.custom_fields.game])),R.concat([["Group"+(b+1)],d],a)}))(c.rounds)}},r=R.curry(j),s=R.curry(l),t=R.curry(m),u=R.curry(p);return R.curryService(q),q}]),angular.module("srApp.services").factory("stats",["statsFactionSelector","statsPlayerSelector","statsCasterSelector","statsGroupByTotal","statsGroupByOppFaction","statsGroupByOppCaster","statsPointsEntry","statsCastersEntry","statsOppCastersEntry","statsTiersEntry","statsReferencesEntry",function(a,b,c,d,e,f,g,h,i,j,k){var l={faction:a,player:b,caster:c},m={total:d,opp_faction:e,opp_caster:f},n={get:function(a,b,c,d,e){if(e[b]=R.defaultTo({},e[b]),e[b][c]=R.defaultTo({},e[b][c]),R.isNil(e[b][c][d])){var f=l[b].select(a,c);f=m[d].group(a,f),e[b][c][d]=R.map(function(b){return[b[0],{points:g.count(a,b[1]),casters:h.count(a,b[1]),opp_casters:i.count(a,b[1]),tiers:j.count(a,b[1]),references:k.count(a,b[1])}]},f)}return e[b][c][d]}};return R.curryService(n),n}]),angular.module("srApp.services").factory("statsPointsEntry",["games",function(a){var b=R.head,c=R.nth(1),d=R.head,e=R.nth(1),f=R.nth(2),g={count:function(g,h){return{colors:["#4AE34D","#E3341D"],values:R.pipe(R.map(function(d){return[a.pointsForPlayer(b(d),null,null,c(d)),a.pointsAgainstPlayer(b(d),null,null,c(d)),c(d).length]}),R.reduce(function(a,b){return[{tournament:d(a).tournament+d(b).tournament,control:d(a).control+d(b).control,army:d(a).army+d(b).army,assassination:d(a).assassination+d(b).assassination},{tournament:e(a).tournament+e(b).tournament,control:e(a).control+e(b).control,army:e(a).army+e(b).army,assassination:e(a).assassination+e(b).assassination},f(b)+f(a)]},[{tournament:0,control:0,army:0,assassination:0},{tournament:0,control:0,army:0,assassination:0},0]),function(a){var b=0===f(a)?1:f(a);return{"Win/Loss":[d(a).tournament,e(a).tournament],Control:[d(a).control/b,e(a).control/b],Army:[d(a).army/b,e(a).army/b],CasterKill:[d(a).assassination,e(a).assassination]}})(h)}},sum:function(a,b){return R.assoc("values",{"Win/Loss":[a.values["Win/Loss"][0]+b.values["Win/Loss"][0],a.values["Win/Loss"][1]+b.values["Win/Loss"][1]],Control:[(a.values.Control[0]+b.values.Control[0])/2,(a.values.Control[1]+b.values.Control[1])/2],Army:[(a.values.Army[0]+b.values.Army[0])/2,(a.values.Army[1]+b.values.Army[1])/2],CasterKill:[a.values.CasterKill[0]+b.values.CasterKill[0],a.values.CasterKill[1]+b.values.CasterKill[1]]},a)}};return R.curryService(g),g}]).factory("statsCastersEntry",["factions","game","players",function(a,b,c){var d=R.head,e=R.nth(1),f=R.head,g=R.nth(1),h={count:function(h,i){var j;return R.pipe(R.chain(function(a){return R.map(function(c){return[d(a),b.listForPlayer(d(a),c)]},e(a))}),R.reject(R.or(R.compose(R.isNil,f),R.compose(R.isNil,g))),R.groupBy(function(a){return R.pipe(c.player$(f(a)),R.defaultTo({}),R.prop("faction"))(h.players)}),R.omit(["undefined"]),R.tap(function(a){j=a}),R.keys,R.map(function(b){var c=R.map(g,j[b]);return[b,R.countBy(R.identity,c),a.hueFor(b)]}))(i)},sum:function(a,b){return R.addHeaderLists(R.addObjects(R.add),a,b)}};return R.curryService(h),h}]).factory("statsOppCastersEntry",["factions","game","players",function(a,b,c){var d=R.head,e=R.nth(1),f=R.head,g=R.nth(1),h={count:function(h,i){var j;return R.pipe(R.chain(function(a){return R.map(function(c){var e=b.opponentForPlayer(d(a),c);return[e,b.listForPlayer(e,c)]},e(a))}),R.reject(R.or(R.compose(R.isNil,f),R.compose(R.isNil,g))),R.groupBy(function(a){return R.pipe(c.player$(f(a)),R.defaultTo({}),R.prop("faction"))(h.players)}),R.tap(function(a){j=a}),R.keys,R.reject(R.eq("undefined")),R.map(function(b){var c=R.map(g,j[b]);return[b,R.countBy(R.identity,c),a.hueFor(b)]}))(i)},sum:function(a,b){return R.addHeaderLists(R.addObjects(R.add),a,b)}};return R.curryService(h),h}]).factory("statsTiersEntry",["list","lists","players","game",function(a,b,c,d){var e=R.head,f=R.nth(1),g=R.head,h=R.nth(1),i={count:function(a,i){return R.pipe(R.map(function(b){return[c.player(e(b),a.players),R.pipe(R.map(d.listForPlayer$(e(b))),R.reject(R.isNil))(f(b))]}),R.reject(R.compose(R.isNil,g)),R.chain(function(a){return R.map(function(c){return R.defaultTo("None",b.themeForCaster(c,g(a).lists))
},h(a))}),R.reject(R.isNil),R.countBy(R.identity))(i)},sum:function(a,b){return R.addObjects(R.add,a,b)}};return R.curryService(i),i}]).factory("statsReferencesEntry",["list","lists","players","game",function(a,b,c,d){var e=R.head,f=R.nth(1),g=R.head,h=R.nth(1),i={count:function(i,j){return R.pipe(R.map(function(a){return[c.player(e(a),i.players),R.pipe(R.map(d.listForPlayer$(e(a))),R.reject(R.isNil),R.uniq)(f(a))]}),R.chain(function(a){return R.map(function(c){var d=R.pipe(g,R.defaultTo({}),R.prop("lists"),R.defaultTo([]))(a);return b.listForCaster(c,d)},h(a))}),R.reject(R.isNil),R.map(a.references),R.chain(R.tail),R.countBy(R.identity))(j)},sum:function(a,b){return R.addObjects(R.add,a,b)}};return R.curryService(i),i}]),angular.module("srApp.services").factory("statsGroupByTotal",[function(){var a={group:function(a,b){return[["Total",b]]}};return R.curryService(a),a}]).factory("statsGroupByOppFaction",["game","players",function(a,b){var c=R.head,d=R.nth(1),e={group:function(e,f){return R.pipe(R.map(function(f){return[c(f),R.pipe(d,R.groupBy(function(d){var g=a.opponentForPlayer(c(f),d),h=R.defaultTo({},b.player(g,e.players));return s.capitalize(R.defaultTo("NULL",R.prop("faction",h)))}),R.omit(["NULL"]))(f)]}),R.reduce(function(a,b){var e=d(b);return R.forEach(function(d){a[d]=R.defaultTo([],a[d]),a[d].push([c(b),e[d]])},R.keys(e)),a},{}),R.toHeaderList,R.sortBy(R.head))(f)}};return R.curryService(e),e}]).factory("statsGroupByOppCaster",["game","players",function(a){var b=R.head,c=R.nth(1),d={group:function(d,e){return R.pipe(R.map(function(d){return[b(d),R.pipe(c,R.groupBy(function(c){var e=a.opponentForPlayer(b(d),c),f=R.defaultTo({},a.player(e,c));return s.capitalize(R.defaultTo("NULL",R.prop("list",f)))}),R.omit(["NULL"]))(d)]}),R.reduce(function(a,d){var e=c(d);return R.forEach(function(c){a[c]=R.defaultTo([],a[c]),a[c].push([b(d),e[c]])},R.keys(e)),a},{}),R.toHeaderList,R.sortBy(R.head))(e)}};return R.curryService(d),d}]),angular.module("srApp.services").factory("statsFactionSelector",["players","rounds",function(a,b){var c={select:function(c,d){var e=a.forFaction(d,c.players);return R.map(function(a){return[a.name,b.gamesForPlayer(a.name,c.rounds)]},e)}};return R.curryService(c),c}]).factory("statsPlayerSelector",["players","rounds",function(a,b){var c={select:function(a,c){return[[c,b.gamesForPlayer(c,a.rounds)]]}};return R.curryService(c),c}]).factory("statsCasterSelector",["players","rounds","games",function(a,b,c){function d(a){return a[0]}function e(a){return a[1]}var f={select:function(f,g){var h=a.forCaster(g,f.players);return R.pipe(R.map(function(a){return[a.name,b.gamesForPlayer(a.name,f.rounds)]}),R.map(function(a){return[d(a),c.forCaster(d(a),g,e(a))]}),R.reject(R.compose(R.isEmpty,e)))(h)}};return R.curryService(f),f}]),angular.module("srApp.services").factory("t3Parser",["player",function(a){function b(a,b){var c=10===a.length;return c||e(b,"invalid fields number ("+a.length+" expected 10)"),c}function c(a,b){var c=s.trim(a[3]).length>0;return c||e(b,"empty player name"),c}function d(a,b){var c=0>R.indexOf(s.trim(a[3]),b.names);return c?b.names.push(s.trim(a[3])):e(b,'player name "'+s.trim(a[3])+'" already exists'),c}function e(a,b){a.errors.push("line "+a.line_number+" "+b)}function f(a){if(s.isBlank(a))return[];for(var b=[],c=new RegExp('(\\;|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\;\\r\\n]*))',"gi"),d=c.exec(a);!R.isNil(d);){var e;e=d[2]?d[2].replace(/\"\"/g,'"'):d[3],b.push(e),d=c.exec(a)}return b}var g={parse:function(b,c){var d=R.reduce(function(a,b){return a[b.t3]=b.name,a},{},R.values(b)),e={errors:[],names:[]},g=R.pipe(s.lines,R.tail,R.filter(R.not(s.isBlank)),R.map(f),R.filterIndexed(function(a,b){e.line_number=b+2;var c=R.map(function(b){return b(a,e)},h);return R.all(R.identity,c)}),R.map(function(a){var b={name:s.capitalize(s.trim(a[3])),origin:a[5]};return R.forEach(function(c){s.include(a[4],c)&&(b.faction=d[c])},R.keys(d)),b}),R.map(function(b){return a.create({name:b.name,faction:b.faction,origin:b.origin})}))(c);return[g,e.errors]}},h=[b,c,d];return R.curryService(g),g}]);