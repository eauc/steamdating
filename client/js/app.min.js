"use strict";angular.module("srApp.services",[]),angular.module("srApp.filters",[]),angular.module("srApp.controllers",[]),angular.module("srApp",["ui.router","srApp.controllers","srApp.filters","srApp.services"]).config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/players"),a.state("players",{url:"/players",templateUrl:"partials/players.html",controller:"playersCtrl",data:{}}).state("players_add",{url:"/players_add",templateUrl:"partials/players_add.html",controller:"playersAddCtrl",data:{}}).state("rounds",{url:"/rounds/:pane",templateUrl:"partials/rounds.html",controller:"roundsCtrl",data:{}}).state("game_edit",{templateUrl:"partials/game_edit.html",controller:"gameEditCtrl",data:{}})}]).config(["$compileProvider",function(a){a.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|blob):/)}]),angular.module("srApp.controllers").controller("gameEditCtrl",["$scope","$stateParams","rounds","players",function(a,b,c,d){a.game=_.snapshot(a.edit.game),a.setWinLoss=function(b,c){a.game[b].tournament=1,a.game[c].tournament=0},a.close=function(b){if(b){_.extend(a.edit.game,a.game);var e=d.player(a.state.players,a.game.p1.name);e.points=c.pointsFor(a.state.rounds,a.game.p1.name);var f=d.player(a.state.players,a.game.p2.name);f.points=c.pointsFor(a.state.rounds,a.game.p2.name);var g=_.chain([]).cat(c.opponentsFor(a.state.rounds,e.name)).cat(c.opponentsFor(a.state.rounds,f.name)).uniq().value();_.each(g,function(b){var e=d.player(a.state.players,b);e.points.sos=d.sosFrom(a.state.players,c.opponentsFor(a.state.rounds,e.name))})}a.goToState("rounds",{pane:a.edit.rounds_pane})}}]),angular.module("srApp.controllers").controller("mainCtrl",["$scope","$state","player","players","rounds",function(a,b,c,d,e){a.edit={},a.state={phantom:c.create("Phantom"),players:[],rounds:[]},a.goToState=_.bind(b.go,b),a.currentState=_.bind(_.getPath,_,b,"current.name"),a.state.players=_.range(7).map(function(b){return{name:"Player"+(b+1),faction:"Faction"+((b/2>>0)+1),city:"City"+((b/3>>0)+1),points:e.pointsFor(a.state.rounds,"Player"+(b+1))}}),a.state.players.push(a.state.phantom),a.state.phantom.points=e.pointsFor(a.state.rounds,"Phantom"),_.each(a.state.players,function(b){b.points.sos=d.sosFrom(a.state.players,e.opponentsFor(a.state.rounds,b.name))})}]),angular.module("srApp.controllers").controller("playersCtrl",["$scope","$state",function(a,b){}]).controller("playersAddCtrl",["$scope","players","player",function(a,b,c){function d(){a.name="Player",a.faction="",a.city=""}d(),a.doAddPlayer=function(){a.state.players=b.add(a.state.players,c.create(a.name,a.faction,a.city),a.state.phantom),a.goToState("players")}}]),angular.module("srApp.controllers").controller("roundsCtrl",["$scope","rounds","players","$stateParams",function(a,b,c,d){function e(c){a[c]=function(d,e){return b.query(a.state.rounds,e,d,c)}}return a.pane=d.pane,a.pane>=a.state.rounds.length?void a.goToState("rounds",{pane:"sum"}):(a.roundsRange=function(){return _.range(a.state.rounds.length)},e("opponentFor"),e("successFor"),e("tableFor"),a.round=function(c){return b.round(a.state.rounds,c)},a.next_round=_.range(a.state.players.length/2).map(function(a){return{table:a+1,p1:{name:null,tournament:null,control:null,army:null},p2:{name:null,tournament:null,control:null,army:null}}}),a.playerNames=function(){return c.names(a.state.players)},a.suggestNextRound=function(){var d=_.chain(a.state.players).apply(c.sort).apply(c.names).value();a.next_round=b.suggestNextRound(a.state.rounds,d)},a.registerNextRound=function(){a.state.rounds.push(a.next_round),a.goToState("rounds",{pane:a.state.rounds.length-1})},void(a.doGameEdit=function(b){a.edit.game=b,a.edit.rounds_pane=a.pane,a.goToState("game_edit")}))}]),angular.module("srApp.filters").filter("playerSort",["players",function(a){return function(b){return a.sort(b)}}]),_.mixin({apply:function(a,b){var c=_.rest(_.rest(arguments));return b.apply(null,_.cons(a,c))}}),_.mixin({mapWith:function(a,b){var c=_.rest(_.rest(arguments)),d=_.partial.apply(null,_.cat([b,_],c));return _.map(a,d)}}),angular.module("srApp.services").factory("player",[function(){var a=function(a){return function(b,c,d){return 0===b?a(c,d):b}},b=a(_.comparator(_.lt)),c=a(_.comparator(_.gt));return{is:_.rcurry2(function(a,b){return a.name===b}),compare:function(a,d){return _.chain(0).apply(b,a.points.tournament,d.points.tournament).apply(b,a.points.sos,d.points.sos).apply(b,a.points.control,d.points.control).apply(b,a.points.army,d.points.army).apply(c,a.name,d.name).value()},create:function(a,b,c){return{name:a,faction:b,city:c,points:{tournament:0,sos:0,control:0,army:0}}}}}]).factory("players",["player",function(a){var b={appendPhantom:function(a,b){return a.length%2===1?_.cat(a,b):a},add:function(c,d,e){return _.chain(c).reject(_.unary(a.is("Phantom"))).cat(d).apply(b.appendPhantom,e).value()},player:function(b,c){return _.find(b,_.unary(a.is(c)))},names:function(a){return _.map(a,_.partial(_.getPath,_,"name"))},sort:function(b){return b.slice().sort(a.compare).reverse()},sosFrom:function(a,c){return _.chain(c).map(_.partial(b.player,a)).reduce(function(a,b){return a+_.getPath(b,"points.tournament")},0).value()}};return b}]),angular.module("srApp.services").factory("game",[function(){var a={create:function(a,b,c){return{table:a,p1:{name:b,tournament:null,control:null,army:null},p2:{name:c,tournament:null,control:null,army:null}}},player:function(a,b){var c=_.getPath(a,"p1.name");return c===b?_.getPath(a,"p1"):_.getPath(a,"p2")},opponentFor:function(a,b){var c=_.getPath(a,"p1.name");return c===b?_.getPath(a,"p2.name"):c},successFor:function(b,c){return _.chain(b).apply(a.player,c).getPath("tournament").value()},tableFor:_.partial(_.getPath,_,"table")};return a}]).factory("round",["game",function(){var a={gameFor:function(a,b){return _.find(a,function(a){return a.p1.name===b||a.p2.name===b})}};return a}]).factory("rounds",["game","round",function(a,b){var c={round:function(a,b){return b>=a.length?[]:a[b]},pointsFor:function(c,d){return _.chain(c).mapWith(b.gameFor,d).mapWith(a.player,d).reduce(function(a,b){return{tournament:a.tournament+b.tournament,control:a.control+b.control,army:a.army+b.army}},{tournament:0,control:0,army:0}).value()},opponentsFor:function(c,d){return _.chain(c).mapWith(b.gameFor,d).mapWith(a.opponentFor,d).value()},tablesFor:function(c,d){return _.chain(c).mapWith(b.gameFor,d).mapWith(a.tableFor,d).value()},query:function(d,e,f,g){return _.chain(d).apply(c.round,e).apply(b.gameFor,f).apply(a[g],f).value()},suggestOpponentFor:function(a,b,d){var e=c.opponentsFor(a,d),f=_.difference(b,e);return 0===f.length?b[0]:f[0]},suggestTableFor:function(a,b,d,e){var f=c.tablesFor(a,d),g=c.tablesFor(a,e),h=_.difference(b,f,g);return 0===h.length?b[0]:h[0]},suggestNextRound:function(b,d){var e=d.length/2,f=d.slice(),g=_.range(1,e+1);return _.chain(_.range(e)).map(function(){var d=f[0];f=_.rest(f);var e=c.suggestOpponentFor(b,f,d);f=_.without(f,e);var h=c.suggestTableFor(b,g,d,e);return g=_.without(g,h),a.create(h,d,e)}).sortBy(_.property("table")).value()}};return c}]);