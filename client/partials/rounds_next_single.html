<div class="text-center">
  <button class="btn btn-default"
          style="margin-bottom: 5px;"
          ng-class="{
          'btn-info': (new_state | state:'playersNotDroped' | players:'areAllPaired':next_round)
          }"
          ng-disabled="!(new_state | state:'playersNotDroped' | players:'areAllPaired':next_round)"
          ng-click="registerNextRound()">
    Register Round
  </button>
  <p class="text-warning"
     ng-if="!previous_round_complete">
    <strong>Previous round is not complete !</strong><br />
    Pairing suggestions are bound to fail...
  </p>
  <div ng-repeat="(gri,gr) in ::new_state.players">
    <h2 ng-if="::new_state | state:'hasPlayerGroups'"
        style="border-bottom:1px solid black;">
      Group{{::$index+1}}
    </h2>
    <h3 ng-if="new_state | state:'isBracketTournament':gri:null">
      Bracket - {{::new_state | state:'bracketRoundOf':gri:null}}
    </h3>
    <strong class="text-warning"
            ng-if="::!(gr | players:'groupSizeIsEven':state.rounds.length)">
      Odd number of players !<br />
      (add a phantom player)
    </strong>
    <table class="table text-center">
      <tr ng-class="{
          'info': (gr | players:'areAllPaired':next_round[gri])
          }">
        <th class="text-center" colspan="3">Player1</th>
        <th class="text-center">Table</th>
        <th class="text-center" colspan="3">Player2</th>
      </tr>
      <tr ng-repeat="(gai, g) in next_round[gri]"
          ng-class="{
          'info': (g | game:'isValid'),
          'warning': pairs_already[gri][gai]
          }">
        <td></td>
        <td></td>
        <td>
          <select ng-model="g.p1.name"
                  ng-change="updatePlayer(gri, gai, 'p1')"
                  ng-options="p[0] as p[1] for p in players_options[gri]"
                  class="form-control">
          </select>
        </td>
        <td>
          <select ng-model="g.table"
                  ng-change="updateTable(gri, gai)"
                  ng-options="t as t for t in tables_ranges[gri]"
                  class="form-control">
          </select>
        </td>
        <td>
          <select ng-model="g.p2.name"
                  ng-change="updatePlayer(gri, gai, 'p2')"
                  ng-options="p[0] as p[1] for p in players_options[gri]"
                  class="form-control">
          </select>
        </td>
        <td></td>
        <td></td>
      </tr>
    </table>
    <button class="btn btn-default"
            ng-click="suggestNextRound(gri, 'sr')"
            ng-if="::!(state | state:'isBracketTournament':gri:state.rounds.length-1)">
      Make SR Suggestion
    </button>
    <button class="btn btn-default"
            ng-click="suggestNextRound(gri, 'bracket')"
            ng-if="::state | state:'canBeBracketTournament':gri"
            >
      Make Bracket Suggestion
    </button>
  </div>
  <p class="text-warning"
     ng-if="!previous_round_complete">
    <strong>Previous round is not complete !</strong><br />
    Pairing suggestions are bound to fail...
  </p>
  <button class="btn btn-default"
          style="margin-top: 5px;"
          ng-class="{
          'btn-info': (new_state | state:'playersNotDroped' | players:'areAllPaired':next_round)
          }"
          ng-disabled="!(new_state | state:'playersNotDroped' | players:'areAllPaired':next_round)"
          ng-click="registerNextRound()">
    Register Round
  </button>
</div>
